<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Barcode Generator</title>


<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e1f22">

<!-- iOS support -->
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">


<style>
  body {
    background-color: #2b2d31;
    color: #ffffff;
    font-family: Arial, sans-serif;
    padding: 40px;
    display: flex;
    justify-content: center;
  }

  .module {
    background-color: #1e1f22;
    padding: 30px 40px;
    border-radius: 22px;
    width: 480px;
  }

  label {
    font-size: 1.05rem;
  }

  input[type="text"] {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    margin-bottom: 14px;
    border: 2px solid #522729;
    border-radius: 6px;
    background-color: #111214;
    color: #fff;
    font-size: 1rem;
  }

  input[type="checkbox"] {
    transform: scale(1.25);
    margin-right: 10px;
    accent-color: #ff3b3b;
  }

  button {
    width: 100%;
    padding: 12px;
    margin-top: 20px;
    background-color: #ff3b3b;
    border: none;
    border-radius: 6px;
    color: white;
    font-size: 1.1rem;
    cursor: pointer;
    font-weight: bold;
  }

  button:hover {
    background-color: #d62828;
  }

  #downloadBtn {
    display: none;
    width: auto;
    padding: 16px 22px;
    margin: 20px auto 0 auto;
    background-color: #ff3b3b;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
  }

  #barcodeCanvas {
    display: block;
    margin: 20px auto;
    background-color: #8D8D8D;
    border-radius: 6px;
    width: 100%;          /* display width fixed */
    max-width: 440px;     /* generous max display size */
  }
</style>
</head>
<body>

<div class="module">

  <label for="textInput">Text:</label>
  <input id="textInput" type="text" autofocus />

  <div style="margin-top: -6px;">
    <input type="checkbox" id="showText" checked>
    <label for="showText">Include text below barcode</label>
  </div>

  <div style="height: 14px;"></div>

  <label for="descInput">Description:</label>
  <input id="descInput" type="text" placeholder="Optional description..." />

  <button id="generateBtn">Generate</button>

  <canvas id="barcodeCanvas"></canvas>

  <button id="downloadBtn">Download PNG</button>

</div>

<script>
/* --- CODE128 subset B encoder --- */
const CODE128_PATTERNS = [
  "11011001100","11001101100","11001100110","10010011000","10010001100","10001001100",
  "10011001000","10011000100","10001100100","11001001000","11001000100","11000100100",
  "10110011100","10011011100","10011001110","10111001100","10011101100","10011100110",
  "11001110010","11001011100","11001001110","11011100100","11001110100","11101101110",
  "11101001100","11100101100","11100100110","11101100100","11100110100","11100110010",
  "11011011000","11011000110","11000110110","10100011000","10001011000","10001000110",
  "10110001000","10001101000","10001100010","11010001000","11000101000","11000100010",
  "10110111000","10110001110","10001101110","10111011000","10111000110","10001110110",
  "11101110110","11010001110","11000101110","11011101000","11011100010","11011101110",
  "11101011000","11101000110","11100010110","11101101000","11101100010","11100011010",
  "11101111010","11001000010","11110001010","10100110000","10100001100","10010110000",
  "10010000110","10000101100","10000100110","10110010000","10110000100","10011010000",
  "10011000010","10000110100","10000110010","11000010010","11001010000","11110111010",
  "11000010100","10001111010","10100111100","10010111100","10010011110","10111100100",
  "10011110100","10011110010","11110100100","11110010100","11110010010","11011011110",
  "11011110110","11110110110","10101111000","10100011110","10001011110","10111101000",
  "10111100010","11110101000","11110100010","10111011110","10111101110","11101011110",
  "11110101110","11010000100","11010010000","11010011100","11000111010"
];

function encodeCode128(text) {
  let codes = [104];
  for (let char of text) {
    let code = char.charCodeAt(0);
    if (code < 32 || code > 126) continue;
    codes.push(code - 32);
  }
  let checksum = 104;
  for (let i = 1; i < codes.length; i++) checksum += codes[i] * i;
  checksum %= 103;
  codes.push(checksum);
  codes.push(106);
  return codes.map(c => CODE128_PATTERNS[c]).join("") + "11";
}

function drawBarcode(text, description, showText) {
  const canvas = document.getElementById("barcodeCanvas");
  const ctx = canvas.getContext("2d");

  /* ============================
     SPACING VARIABLES
     ============================ */
  const DESC_SPACING_1 = 2;
  const BLACK_DIVIDER_SIZE = 2;
  const DESC_SPACING_2 = 10;
  const TEXT_SPACING = 9;

  const VERT_MARGIN = 10;
  const HORI_MARGIN = 30;

  /* ============================ */

  const pattern = encodeCode128(text);

  const barWidth = 2;
  const barHeight = 100;

  /* Full-resolution canvas width */
  const fullWidth = pattern.length * barWidth + HORI_MARGIN * 2;

  /* Display width cap (module width) */
  const maxDisplayWidth = 440;

  /* Scaling factor (only for display) */
  const scale = Math.min(1, maxDisplayWidth / fullWidth);

  /* Canvas internal size stays full resolution */
  let height = VERT_MARGIN;

  if (description) {
    height += 30;
    height += DESC_SPACING_1;
    height += BLACK_DIVIDER_SIZE;
    height += DESC_SPACING_2;
  }

  height += barHeight;

  if (showText) {
    height += TEXT_SPACING;
    height += 30;
  }

  height += VERT_MARGIN;

  canvas.width = fullWidth;
  canvas.height = height;

  ctx.fillStyle = "#8D8D8D";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  let y = VERT_MARGIN;

  if (description) {
    ctx.textAlign = "center";
    ctx.fillStyle = "#000000";
    ctx.font = "20px Arial";
    ctx.fillText(description, canvas.width / 2, y + 22);
    y += 30 + DESC_SPACING_1;

    ctx.fillRect(HORI_MARGIN, y, canvas.width - HORI_MARGIN * 2, BLACK_DIVIDER_SIZE);
    y += BLACK_DIVIDER_SIZE + DESC_SPACING_2;
  }

  let x = HORI_MARGIN;
  ctx.fillStyle = "#000000";
  for (let bit of pattern) {
    if (bit === "1") ctx.fillRect(x, y, barWidth, barHeight);
    x += barWidth;
  }

  y += barHeight;

  if (showText) {
    y += TEXT_SPACING;
    ctx.textAlign = "center";
    ctx.fillStyle = "#000000";
    ctx.font = "22px Arial";
    ctx.fillText(text, canvas.width / 2, y + 22);
  }

  /* Apply display scaling */
  canvas.style.transform = `scale(${scale})`;
  canvas.style.transformOrigin = "top center";
}

document.getElementById("generateBtn").addEventListener("click", () => {
  const text = document.getElementById("textInput").value.trim();
  const description = document.getElementById("descInput").value.trim();
  const showText = document.getElementById("showText").checked;

  if (text.length > 0) {
    drawBarcode(text, description, showText);
    document.getElementById("downloadBtn").style.display = "block";
  }
});

document.getElementById("downloadBtn").addEventListener("click", () => {
  const canvas = document.getElementById("barcodeCanvas");
  const link = document.createElement("a");
  link.download = "barcode.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});



</script>
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js")
      .catch(err => console.log("SW registration failed:", err));
  });
}
</script>

</body>
</html>
