<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Barcode Generator — black on #8d8d8d</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ✅ PWA manifest + theme color -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f0f10">

  <!-- JsBarcode CDN -->
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

  <style>
    :root {
      --bg: #0f0f10;
      --card: #16181a;
      --text: #e6e9ef;
      --muted: #9aa4b2;
      --accent: #5cc8ff;
      --panel: #8d8d8d;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: grid;
      place-items: center;
      min-height: 100vh;
      padding: 24px;
    }
    .app {
      width: 100%;
      max-width: 820px;
      background: var(--card);
      border-radius: 14px;
      padding: 20px;
      border: 1px solid #232832;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .row { display: grid; gap: 12px; }
    label { font-size: 13px; color: var(--muted); display: block; margin-bottom: 6px; }
    input, select, button {
      width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #2a3242;
      background: #0d1117; color: var(--text); outline: none; transition: border .2s ease;
    }
    input:focus, select:focus { border-color: var(--accent); }
    button {
      background: linear-gradient(180deg, #5cc8ff, #3aa0ff);
      border: none; color: #07121f; font-weight: 600; cursor: pointer;
    }
    button:hover { filter: brightness(1.05); }

    /* ✅ Download button styling */
    #downloadBtn {
      margin: 20px auto 0 auto;
      display: none;
      width: 60%;
      font-size: 1.3rem;
      padding: 14px;
      border-radius: 12px;
      background: linear-gradient(180deg, #5cc8ff, #3aa0ff);
      color: #07121f;
      font-weight: 700;
      cursor: pointer;
      text-align: center;
    }

    .output {
      margin-top: 18px;
      background: var(--panel);
      border: 1px dashed #2a3242;
      border-radius: 12px;
      display: grid;
      place-items: center;
      min-height: 260px;
      padding: 20px;
    }
    @media print {
      body { background: #ffffff; color: #000; }
      .output { background: #8d8d8d !important; }
      svg, canvas {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
    }
    svg#barcode {
      width: 100%;
      height: auto;
      shape-rendering: crispEdges;
      image-rendering: pixelated;
      background: #8d8d8d;
    }
    .footer { margin-top: 12px; font-size: 12px; color: var(--muted); }
    .error { color: #ff5c8a; font-size: 13px; margin-top: 6px; }
    .small { font-size: 12px; color: var(--muted); margin-top: 6px; }
  </style>
</head>
<body>
  <div class="app">
    <h2 style="margin:0 0 10px 0;">Barcode generator</h2>
    <p class="small">Bars are forced to black (#000000); background is #8d8d8d. Works in SVG or Canvas.</p>

    <!-- ✅ DATA (own line) -->
    <div class="row" style="grid-template-columns: 1fr;">
      <div>
        <label for="input">Data</label>
        <input id="input" type="text" placeholder="e.g., 123456789012 or any text" />
        <div id="error" class="error" style="display:none;"></div>
      </div>
    </div>

    <!-- ✅ FORMAT + RENDER (same line) -->
    <div class="row" style="grid-template-columns: 1fr 1fr;">
      <div>
        <label for="format">Format</label>
        <select id="format">
          <option value="CODE128" selected>CODE128 (text/numbers)</option>
          <option value="CODE39">CODE39 (text/numbers)</option>
          <option value="EAN13">EAN-13 (12–13 digits)</option>
        </select>
      </div>

      <div>
        <label for="render">Render</label>
        <select id="render">
          <option value="svg" selected>SVG</option>
          <option value="canvas">Canvas</option>
        </select>
      </div>
    </div>

    <!-- ✅ GENERATE BUTTON (own line) -->
    <div class="row" style="grid-template-columns: 1fr;">
      <div>
        <label>&nbsp;</label>
        <button id="generate">Generate</button>
      </div>
    </div>

    <!-- ✅ HEIGHT + WIDTH + SHOW VALUE (same line) -->
    <div class="row" style="grid-template-columns: 1fr 1fr 1fr;">
      <div>
        <label for="height">Height</label>
        <input id="height" type="number" min="40" max="220" value="100" />
      </div>

      <div>
        <label for="width">Bar width</label>
        <input id="width" type="number" step="0.2" min="0.8" max="4" value="2" />
      </div>

      <div>
        <label for="displayValue">Show value</label>
        <select id="displayValue">
          <option value="true" selected>Yes</option>
          <option value="false">No</option>
        </select>
      </div>
    </div>

    <div class="output">
      <svg id="barcode"></svg>
      <canvas id="barcodeCanvas" style="display:none;"></canvas>
    </div>

    <!-- ✅ DOWNLOAD BUTTON -->
    <button id="downloadBtn">Download Barcode</button>

    <div class="footer">
      <span>Tips:</span>
      <ul style="margin:6px 0 0 18px;">
        <li><strong>CODE128:</strong> Best general choice; compact, supports any ASCII text.</li>
        <li><strong>EAN-13:</strong> Requires 12 digits (check digit will be added) or 13 digits.</li>
        <li><strong>CODE39:</strong> Simpler, but larger barcodes; supports A–Z, 0–9, and - . space $ / + %.</li>
      </ul>
    </div>
  </div>

  <script>
    const elInput = document.getElementById('input');
    const elFormat = document.getElementById('format');
    const elRender = document.getElementById('render');
    const elHeight = document.getElementById('height');
    const elWidth = document.getElementById('width');
    const elDisplayValue = document.getElementById('displayValue');
    const elError = document.getElementById('error');

    const svgTarget = document.getElementById('barcode');
    const canvasTarget = document.getElementById('barcodeCanvas');
    const downloadBtn = document.getElementById('downloadBtn');

    function validateInput(value, format) {
      if (format === 'EAN13') {
        const digitsOnly = value.replace(/\D+/g, '');
        if (digitsOnly.length !== value.length) return 'EAN-13 accepts digits only.';
        if (digitsOnly.length !== 12 && digitsOnly.length !== 13) {
          return 'Enter 12 digits (check digit will be added) or 13 digits.';
        }
      }
      return '';
    }

    function paintCanvasBackground(ctx, w, h, color) {
      ctx.save();
      ctx.fillStyle = color;
      ctx.fillRect(0, 0, w, h);
      ctx.restore();
    }

    function generate() {
      const value = elInput.value.trim();
      const format = elFormat.value;
      const render = elRender.value;
      const height = parseInt(elHeight.value, 10) || 100;
      const width = parseFloat(elWidth.value) || 2;
      const displayValue = elDisplayValue.value === 'true';

      const errorMsg = validateInput(value, format);
      if (errorMsg) {
        elError.textContent = errorMsg;
        elError.style.display = 'block';
        return;
      } else {
        elError.style.display = 'none';
      }

      const options = {
        format,
        lineColor: "#000000",
        background: "#8d8d8d",
        width,
        height,
        displayValue,
        margin: 12
      };

      if (render === 'svg') {
        svgTarget.style.display = 'block';
        canvasTarget.style.display = 'none';
        while (svgTarget.firstChild) svgTarget.removeChild(svgTarget.firstChild);
        JsBarcode(svgTarget, value, options);
        const rects = svgTarget.querySelectorAll('rect');
        rects.forEach(r => {
          r.setAttribute('fill', '#000000');
          r.setAttribute('shape-rendering', 'crispEdges');
        });
        svgTarget.style.background = '#8d8d8d';
      } else {
        svgTarget.style.display = 'none';
        canvasTarget.style.display = 'block';
        const ctx = canvasTarget.getContext('2d');
        const estimatedWidth = Math.max(320, Math.ceil(value.length * width * 12));
        canvasTarget.width = estimatedWidth;
        canvasTarget.height = height + (displayValue ? 40 : 20);
        paintCanvasBackground(ctx, canvasTarget.width, canvasTarget.height, '#8d8d8d');
        JsBarcode(canvasTarget, value, options);
      }

      downloadBtn.style.display = "block";
    }

    document.getElementById('generate').addEventListener('click', generate);
    elInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') generate(); });

    /* ✅ Download logic */
    downloadBtn.addEventListener("click", () => {
      const render = elRender.value;

      if (render === "svg") {
        const serializer = new XMLSerializer();
        const svgData = serializer.serializeToString(svgTarget);
        const blob = new Blob([svgData], { type: "image/svg+xml" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "barcode.svg";
        a.click();
        URL.revokeObjectURL(url);
      } else {
        canvasTarget.toBlob(blob => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "barcode.png";
          a.click();
          URL.revokeObjectURL(url);
        });
      }
    });

    /* ✅ Register service worker for PWA */
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
</body>
</html>
